/*! branch-and-bound 2013-11-04 */
function Bnb(a){var b=this;if(b.loopAbort=10,"min"!==a)throw"Only minimizes for now.";var c=function(a){a.upper=b.upperBound(a),a.lower=b.lowerBound(a)},d=function(a,b){for(var c=0,d=0,e={split:(a.split||0)+1},f={split:(a.split||0)+1},g=0;g<b.length;g++){var h=b[g],i=a[h],j=i.max-i.min;i.splitWeight&&(j*=i.splitWeight),j>=c&&(c=j,d=h),e[h]={min:i.min,max:i.max,isDiscrete:!!i.isDiscrete,splitWeight:i.splitWeight||1},f[h]={min:i.min,max:i.max,isDiscrete:!!i.isDiscrete,splitWeight:i.splitWeight||1}}var k=a[d],l=k.min+.51*(k.max-k.min),m=l,n=l;return k.isDiscrete&&(m=Math.floor(m),n=Math.ceil(n)),e[d].max=m,f[d].min=n,{left:e,right:f}},e=function(a,b){var c=null;return b.minLower=1/0,b.minUpper=1/0,a.all(function(a){a.lower<b.minLower&&(b.minLower=a.lower),a.upper<b.minUpper&&(b.minUpper=a.upper,c=a)}),c};this.start=function(a){var b=[];for(var f in this.initialBox)this.initialBox.hasOwnProperty(f)&&"object"==typeof this.initialBox[f]&&b.push(f);c(this.initialBox);var g={minLower:this.initialBox.lower,minUpper:this.initialBox.upper},h=new Queue;h.enqueue(this.initialBox);var i=0;this.bestBox||(this.bestBox=this.initialBox);for(var j=!1,k=1e3;i++<this.loopAbort;){for(var l=null;null===l;)l=h.dequeue(),l.lower>g.minUpper&&(l=null);var m=d(l,b);(l.lower===g.minLower||l.upper===g.minUpper)&&(j=!0);var n=m.left;c(n),n.lower<g.minLower||n.upper<g.minUpper?(n.lower<g.minLower&&(g.minLower=n.lower),n.upper<g.minUpper&&(g.minUpper=n.upper,this.bestBox=n),h.cheat(n)):h.enqueue(n);var o=m.right;if(c(o),o.lower<g.minLower||o.upper<g.minUpper?(o.lower<g.minLower&&(g.minLower=o.lower),o.upper<g.minUpper&&(g.minUpper=o.upper,this.bestBox=o),h.cheat(o)):h.enqueue(o),j&&i%k===0&&(this.bestBox=e(h,g),j=!1),this.iteration({count:i,bounds:g,bestBox:this.bestBox}),g.minUpper-g.minLower<=this.tolerance)return a(null,this),void 0}}}